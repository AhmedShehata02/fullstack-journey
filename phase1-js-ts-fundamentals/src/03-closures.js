/********************************************************************
 ๐งฉ LESSON 3 โ CLOSURES, SCOPE CHAIN & EXECUTION STACK
 ๐ ุงููุฏู:
 - ุชูููู ุฅุฒุงู JavaScript ุจุชูููุฐ ุงูููุฏ ูุนูููุง (Execution Context)
 - ุชููู ููุฑุฉ ุงูู Scope Chain (ุณูุณูุฉ ุงููุตูู)
 - ุชุชูู ููููู ุงูู Closure (ููู ูุงุญุฏ ูู ุฃูู ููุงููู JS)
********************************************************************/


/********************************************************************
 โ 1. ููุฏูุฉ โ ููู ุจุชูููุฐ JavaScript ุงูููุฏุ
 --------------------------------------------------------------------
 ุฃู ุจุฑูุงูุฌ JavaScript ุจูุชููุฐ ุนูู ูุฑุญูุชูู ุฏุงุฎู ูุง ูุณูู:

 ๐ Execution Context (ุณูุงู ุงูุชูููุฐ)

 ููู Execution Context ุจูุชูููู ูู ูุฑุญูุชูู:
 1๏ธโฃ Creation Phase (ูุฑุญูุฉ ุงูุฅูุดุงุก)
   - ุจูุชู ูููุง ุฅูุดุงุก ุงูู Scope
   - ูุชุณุฌูู ุงููุชุบูุฑุงุช ูุงูุฏูุงู ูู ุงูุฐุงูุฑุฉ
 2๏ธโฃ Execution Phase (ูุฑุญูุฉ ุงูุชูููุฐ)
   - ุงูููุฏ ุจูุชููุฐ ูุนูููุง ุฎุทูุฉ ุจุฎุทูุฉ

 ููู ุฏุงูุฉ ุฌุฏูุฏุฉ ุจุชููุดุฆ Execution Context ุฌุฏูุฏ ุฎุงุต ุจููุง.
********************************************************************/

console.log("---- 1. Execution Context ----");

function outer() {
  console.log("Inside outer()");
  inner(); // ูุฏุงุก ูุฏุงูุฉ ุฏุงุฎููุฉ

  function inner() {
    console.log("Inside inner()");
  }
}

outer();

/*
๐ง ุชุญุช ุงูููุงููุณ:
- JavaScript ุจุชุจุฏุฃ ุจุฅูุดุงุก Global Execution Context.
- ููุง ุชูุงุฏู outer() โ ุจูููุดุฃ Execution Context ุฌุฏูุฏ ุฎุงุต ุจุงูุฏุงูุฉ.
- ุฏุงุฎู outer() ููุง ุชูุงุฏู inner() โ ุจูุชุนูู Context ุฌุฏูุฏ ููุง ููุงู.
*/


/********************************************************************
 โ 2. Scope & Scope Chain
 --------------------------------------------------------------------
 - Scope = "ุงููุทุงู" ุฃู "ุงููุฏู" ุงููู ุจูุญุฏุฏ ูููู ุชูุฏุฑ ุชุดูู ุงููุชุบูุฑ.
 - Scope Chain = ุณูุณูุฉ ุงูุฑุจุท ุจูู ุงูู Scopes ูููุตูู ูููุชุบูุฑุงุช.
********************************************************************/

console.log("---- 2. Scope Chain Example ----");

let globalVar = "๐ Global";

function firstLevel() {
  let firstVar = "1๏ธโฃ First Level";

  function secondLevel() {
    let secondVar = "2๏ธโฃ Second Level";

    console.log(globalVar);  // โ ูุดูู ูู ุงูู global scope
    console.log(firstVar);   // โ ูุดูู ูู ุงูู parent scope
    console.log(secondVar);  // โ ูุดูู ูู ููุณ ุงูู scope
  }

  secondLevel();
}

firstLevel();

/*
๐ ุงููุจุฏุฃ:
- ูู ูุชุบูุฑ ูุด ููุฌูุฏ ูู ุงูู scope ุงูุญุงููุ
  JS ุจุชุฏูุฑ ุนููู ูู ุงูู scope ุงูุฃุนูู (parent),
  ูููุฐุง ูุญุฏ ุงูู global.

ุฏู ุงุณูู ๐ Scope Chain.
*/


/********************************************************************
 โ 3. Lexical Scope
 --------------------------------------------------------------------
 - ุงููููุฉ "Lexical" ูุนูุงูุง ุฅู ุงูู scope ุจูุชุญุฏุฏ ุฃุซูุงุก ูุชุงุจุฉ ุงูููุฏุ
   ูุด ุฃุซูุงุก ุงูุชุดุบูู.
********************************************************************/

console.log("---- 3. Lexical Scope Example ----");

function outerFunc() {
  const outerMsg = "I'm outer variable";

  function innerFunc() {
    console.log(outerMsg); // โ ุดุงูู ุงููุชุบูุฑ ุงููู ูู outerFunc
  }

  return innerFunc;
}

const fn = outerFunc();
fn(); // โ still remembers outerMsg even ุจุนุฏ ุงูุชูุงุก outerFunc!

/*
๐ง ุฏู ูู ุฃุณุงุณ ุงูู Closure:
ุงูุฏุงูุฉ ุจุชุชุฐูุฑ ุงููุชุบูุฑุงุช ุงููู ูุงูุช ุญูุงููููุง ููุช ุฅูุดุงุฆูุงุ
ุญุชู ุจุนุฏ ุงูุชูุงุก ุงูู scope ุงูุฃุตูู.
*/


/********************************************************************
 โ 4. Closures (ุงูุฅุบูุงู)
 --------------------------------------------------------------------
 - Closure = ููุง ุฏุงูุฉ "ุชุญุชูุธ" ุจุงููุตูู ุฅูู ูุชุบูุฑุงุช ุฎุงุฑุฌ ูุทุงููุง.
 - ูุซุงู ููุงุณููู ุฌุฏูุง ๐
********************************************************************/

console.log("---- 4. Closure Example ----");

function makeCounter() {
  let count = 0; // ูุชุบูุฑ ุฎุงุต ุฏุงุฎู ุงูุฏุงูุฉ

  return function () {
    count++;
    console.log("Current count:", count);
  };
}

const counter1 = makeCounter();
counter1(); // 1
counter1(); // 2
counter1(); // 3

const counter2 = makeCounter();
counter2(); // 1 (ูุณุชูู ุนู ุงูุฃูู)

/*
๐ง ูุงุญุธ:
ูู ูุฏุงุก ูู makeCounter() ุจููููู ุจูุฆุฉ ูุณุชููุฉ ูููุง ูุชุบูุฑ count ุฎุงุต ุจููุง.
ูู closure ุจููุถู ูุญุชูุธ ุจูุณุฎุชู ุงูุฎุงุตุฉ ูู count.
*/


/********************************************************************
 โ 5. Practical Example โ Private Variables (ุจุงุณุชุฎุฏุงู Closures)
 --------------------------------------------------------------------
 Closures ุจุชุณูุญูู ุชุนูู data hiding (ุฒู private fields ูู OOP)
********************************************************************/

console.log("---- 5. Closure for Private Data ----");

function createUser(name) {
  let balance = 0; // ูุชุบูุฑ ุฎุงุต

  return {
    getName: () => name,
    deposit: (amount) => (balance += amount),
    getBalance: () => balance,
  };
}

const user1 = createUser("Ahmed");
user1.deposit(100);
console.log(user1.getName(), "balance:", user1.getBalance()); // Ahmed balance: 100

const user2 = createUser("Mona");
console.log(user2.getBalance()); // 0 (ูููุตู ุชูุงููุง)

/*
๐ก ุงูููุฑุฉ:
ุงููุชุบูุฑ balance "ุฎุงุต" ูุง ูููู ุงููุตูู ูู ูู ุงูุฎุงุฑุฌุ
ููู ุงูุฏูุงู ุงูุฏุงุฎููุฉ (closures) ุชูุฏุฑ ุชุดููู ูุชุนุฏูู ุนููู.
*/


/********************************************************************
 โ 6. Closures inside loops (ูุดููุฉ var)
 --------------------------------------------------------------------
 - ุนูุฏ ุงุณุชุฎุฏุงู var ุฏุงุฎู loopุ ูู ุงูุฏูุงู ุจุชุดูุฑ ูููุณ ุงููุชุบูุฑ.
 - ุงูุญู โ ุงุณุชุฎุฏุงู let (ููู ุฏูุฑุฉ ูุณุฎุฉ ุฌุฏูุฏุฉ).
********************************************************************/

console.log("---- 6. Closure in Loops ----");

// โ ุจุงุณุชุฎุฏุงู var โ ุงููู ููุชุทุจุน ุขุฎุฑ ูููุฉ ููุท
for (var i = 1; i <= 3; i++) {
  setTimeout(() => console.log("var loop i:", i), 10);
}

// โ ุจุงุณุชุฎุฏุงู let โ ูู ูุงุญุฏุฉ ูููุง ูุณุฎุฉ ุฎุงุตุฉ
for (let j = 1; j <= 3; j++) {
  setTimeout(() => console.log("let loop j:", j), 10);
}

/*
๐ฆ ููู ูุฏูุ
- var ุจูููู ูู Scope ูุงุญุฏ ุนูู ูุณุชูู ุงูุฏุงูุฉ.
- let ุจูุนูู Scope ุฌุฏูุฏ ูู ูู iteration.
*/


/********************************************************************
 โ 7. Execution Stack Visualization (ุชุฎูู ุงูุชูููุฐ)
 --------------------------------------------------------------------
 JS ุชุณุชุฎุฏู Stack (ุงูููุฏุณ) ูุชุชุจุน ุงูุชูููุฐ:
 - Global context ูุฏุฎู ุงูุฃูู
 - ูู ุฏุงูุฉ ุฌุฏูุฏุฉ ุชุฏุฎู ูููู
 - ุจุนุฏ ุงูุชูุงุก ุงูุฏุงูุฉ โ ุชุฎุฑุฌ ูู ุงูู stack
********************************************************************/

console.log("---- 7. Execution Stack Simulation ----");

function A() {
  console.log("Inside A");
  B();
}
function B() {
  console.log("Inside B");
  C();
}
function C() {
  console.log("Inside C");
}

A();

/*
๐ง Stack ููุช ุงูุชูููุฐ:
  |   |
  | C | โ ุชูููุฐ C()
  | B |
  | A |
  | Global |
*/


/********************************************************************
 โ 8. Mini Project โ Counter with Reset & Private State
 --------------------------------------------------------------------
 ุชูุฑูู ุนูู ุงูู Closures + Scope
********************************************************************/

console.log("---- 8. Mini Project: Counter ----");

function createAdvancedCounter() {
  let value = 0;

  return {
    inc: () => ++value,
    dec: () => --value,
    reset: () => (value = 0),
    get: () => value,
  };
}

const counter = createAdvancedCounter();
counter.inc();
counter.inc();
console.log("Counter value:", counter.get()); // 2
counter.reset();
console.log("Counter after reset:", counter.get()); // 0


/********************************************************************
 ๐ช ุชูุงุฑูู ุนูููุฉ (ุฌุฑุจ ุจููุณู)
 --------------------------------------------------------------------
 1๏ธโฃ ุงูุชุจ ุฏุงูุฉ makeMultiplier(n) ุชุนูุฏ ุฏุงูุฉ ุชุถุฑุจ ุฃู ุฑูู ูู n.
     const double = makeMultiplier(2);
     console.log(double(5)); // 10

 2๏ธโฃ ุงูุชุจ createBankAccount() ูููุง:
     - deposit(amount)
     - withdraw(amount)
     - getBalance()
     (ูููู ูุณุชุฎุฏููุง closure ุนุดุงู ูุญุงูุธูุง ุนูู ุงูุฑุตูุฏ)

 3๏ธโฃ ุฌุฑูุจ ุชุนูู loop ุจู var ู let ูุดูู ุงููุฑู ูู closure.

 4๏ธโฃ ุงุดุฑุญ ูููุณู ุจุตูุช ุนุงูู: ููู closure ููู ูู React ุฃู Node.jsุ
********************************************************************/


/********************************************************************
 ๐งฉ Quick Summary
 --------------------------------------------------------------------
 โ Execution Context โ ูู ุฏุงูุฉ ูููุง ุจูุฆุฉ ุชูููุฐ ูุณุชููุฉ
 โ Scope Chain โ ุงูุจุญุซ ุนู ุงููุชุบูุฑุงุช ูุชู ูู ุงูุฏุงุฎู ููุฎุงุฑุฌ
 โ Lexical Scope โ ุจูุชุญุฏุฏ ููุช ูุชุงุจุฉ ุงูููุฏุ ูุด ููุช ุงูุชุดุบูู
 โ Closure โ ุงูุฏุงูุฉ ุชุชุฐูุฑ ุจูุฆุชูุง ุงูุฃุตููุฉ ุญุชู ุจุนุฏ ุงูุชูุงุก ุงูุชูููุฐ
 โ Useful for: data hiding, counters, event handlers, async logic
********************************************************************/
