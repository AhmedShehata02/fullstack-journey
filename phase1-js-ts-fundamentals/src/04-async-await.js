/********************************************************************
 ๐งฉ LESSON 3 โ ASYNC, AWAIT, PROMISES & EVENT LOOP
 ๐ ุงููุฏู:
 ููู ููููุฉ ุชูููุฐ JavaScript ููุนูููุงุช ุบูุฑ ุงููุชุฒุงููุฉ (Asynchronous)
 ูุชุนูู ุงุณุชุฎุฏุงู Promise ู async/await ุจุดูู ุนููู.
********************************************************************/


/********************************************************************
 โ 1. Synchronous vs Asynchronous
 --------------------------------------------------------------------
 - JavaScript ูุบุฉ single-threaded (ูุนูู ุจุชูููุฐ ุณุทุฑ ุจุณ ูู ูู ูุญุธุฉ).
 - ุฃู ููุฏ ุนุงุฏู ุจูุชููุฐ ุจุงูุชุฑุชูุจ (Synchronous).
 - ููู ุจุนุถ ุงูุนูููุงุช (ุฒู ุงูุดุจูุฉ ุฃู ุงูุชุงููุฑ) ุจุชุดุชุบู ุจุดูู ุบูุฑ ูุชุฒุงูู
   ุนู ุทุฑูู ุงูู Web APIs โ Event Loop โ Callback Queue.
********************************************************************/

console.log("---- 1. Sync vs Async ----");

console.log("Start");

setTimeout(() => console.log("Async: setTimeout done โ"), 1000);

console.log("End");

/*
ุงููุชูุฌุฉ:
Start
End
Async: setTimeout done โ

๐ง ูููุ ูุฃู setTimeout ุจูุฑูุญ ููู Web APIุ ูุจูุชููุฐ ุจุนุฏ ุจุงูู ุงูููุฏ.
*/


/********************************************************************
 โ 2. The Event Loop (ุญููุฉ ุงูุฃุญุฏุงุซ)
 --------------------------------------------------------------------
 - ูู ุงูุขููุฉ ุงููู ุจุชุฎูู JS ุชุดุชุบู ูุฃููุง "ูุชุนุฏุฏุฉ ุงูููุงู".
 - ุฃู ููุฏ async ุจูุฑูุญ ููู Web APIs.
 - ููุง ูุฎูุตุ ุจูุฑุฌุน ููู Callback Queue.
 - ุงูู Event Loop ุจููููู ูู ุงูู Queue ุฅูู ุงูู Call Stack ููุง ุชูุถู.
********************************************************************/

console.log("---- 2. Event Loop Visualization ----");

console.log("1๏ธโฃ First log");

setTimeout(() => console.log("2๏ธโฃ Timeout finished"), 0);

console.log("3๏ธโฃ Last log");

/*
๐ ุงูุชูููุฐ:
 1๏ธโฃ โ ูุฏุฎู ุงูู Stack ููุชููุฐ ููุฑูุง.
 2๏ธโฃ โ ูุชุญุท ูู Web API.
 3๏ธโฃ โ ูุชุญุท ูู Queue ุจุนุฏ ูุง ุงูููุฏ ุงูุฃุณุงุณู ูุฎูุต.
*/


/********************************************************************
 โ 3. Promises โ ุญู ูุดููุฉ "Callback Hell"
 --------------------------------------------------------------------
 Promise = ูุงุฆู ููุซู ุนูููุฉ ูุฏ ุชูุชูู ูู ุงููุณุชูุจู ุฃู ุชูุดู.
********************************************************************/

console.log("---- 3. Promises ----");

const fetchData = (success) =>
  new Promise((resolve, reject) => {
    setTimeout(() => {
      success ? resolve("โ Data loaded!") : reject("โ Error loading data!");
    }, 1000);
  });

fetchData(true)
  .then((data) => console.log("Promise resolved:", data))
  .catch((err) => console.log("Promise rejected:", err))
  .finally(() => console.log("Promise finished"));

/*
๐ง ุงูุญุงูุงุช:
 - Pending โ ุงูุนูููุฉ ูุณู ุดุบุงูุฉ
 - Fulfilled โ ุชูุช ุจูุฌุงุญ (resolve)
 - Rejected โ ูุดูุช (reject)
*/


/********************************************************************
 โ 4. Chaining Promises
 --------------------------------------------------------------------
 ูููู ูุฑุจุท ูุฑุง ุจุนุถ .then() ุนูุดุงู ูููุฐ ุฃูุชุฑ ูู ุฎุทูุฉ ุจุงูุชุณูุณู.
********************************************************************/

console.log("---- 4. Promise Chaining ----");

fetchData(true)
  .then((msg) => {
    console.log(msg);
    return "โก Next step after data";
  })
  .then((step) => console.log(step))
  .catch((err) => console.log("Error:", err));


/********************************************************************
 โ 5. async / await
 --------------------------------------------------------------------
 - ุฃุณููุจ ุฃุญุฏุซ (ES8) ุจูุฎูู ุงูููุฏ ุงูุฃุณููุฑูู ุดููู ุดุจู ุงูููุฏ ุงูุนุงุฏู.
 - await ูุงุฒู ุชุณุชุฎุฏููุง ุฌูุง ุฏุงูุฉ ูุชุนุฑูุฉ ุจู async.
********************************************************************/

console.log("---- 5. async / await ----");

async function loadData() {
  console.log("Fetching...");
  try {
    const result = await fetchData(true);
    console.log("Result:", result);
  } catch (error) {
    console.log("Error:", error);
  } finally {
    console.log("Done!");
  }
}

loadData();

/*
๐ก await ุจุชููู ุงูุชูููุฐ ูุคูุชูุง ูุญุฏ ูุง ุงูู Promise ูุฎูุต.
ุงูููุฏ ุจูุจุงู ูุฃูู ูุชุฒุงูู ุจุณ ูุนูููุง ูู async ุจุงููุงูู.
*/


/********************************************************************
 โ 6. Error Handling in async/await
 --------------------------------------------------------------------
 - ูุณุชุฎุฏู try/catch ุจุฏู .catch()
********************************************************************/

console.log("---- 6. async/await Error Handling ----");

async function loadWithError() {
  try {
    const data = await fetchData(false);
    console.log(data);
  } catch (error) {
    console.error("Caught error:", error);
  }
}

loadWithError();


/********************************************************************
 โ 7. Parallel Execution โ Promise.all
 --------------------------------------------------------------------
 - ูุชุดุบูู ุฃูุชุฑ ูู ุนูููุฉ async ูู ููุณ ุงูููุช.
 - Promise.all ููุชุธุฑ ูู ุงููุนูุฏ ูุน ุจุนุถ.
********************************************************************/

console.log("---- 7. Promise.all ----");

const task1 = fetchData(true);
const task2 = fetchData(true);
const task3 = fetchData(true);

Promise.all([task1, task2, task3])
  .then((res) => console.log("All done:", res))
  .catch((err) => console.log("One failed:", err));


/********************************************************************
 โ 8. Promise.race
 --------------------------------------------------------------------
 - ุจุชุงุฎุฏ ุฃูู Promise ูุฎูุต ุณูุงุก ูุฌุญ ุฃู ูุดู.
********************************************************************/

console.log("---- 8. Promise.race ----");

const fast = new Promise((res) => setTimeout(() => res("๐ Fast!"), 300));
const slow = new Promise((res) => setTimeout(() => res("๐ข Slow!"), 1000));

Promise.race([fast, slow]).then((result) => console.log(result));


/********************************************************************
 โ 9. Practical Example โ Fetch API (ูุญุงูุงุฉ)
 --------------------------------------------------------------------
 ูุซุงู ูุดุจู ุงุณุชุฏุนุงุก API ุญูููู.
********************************************************************/

console.log("---- 9. Practical Example ----");

async function getUser() {
  console.log("Loading user...");
  const user = await fetchData(true);
  console.log("User loaded:", user);
}

getUser();

/*
๐ง ูู ุงููุงูุนุ ููุณุชุฎุฏู:
  const res = await fetch("https://api.example.com/user");
  const data = await res.json();
*/


/********************************************************************
 โ 10. Event Loop & Microtasks (Promises vs setTimeout)
 --------------------------------------------------------------------
 Promises ุจุชุชููุฐ ูู ุงูู Microtask Queue
 setTimeout ูู ุงูู Macrotask Queue
********************************************************************/

console.log("---- 10. Microtasks vs Macrotasks ----");

setTimeout(() => console.log("Timeout callback"), 0);
Promise.resolve().then(() => console.log("Promise callback"));

console.log("Main script end");

/*
๐ง ุงูุชุฑุชูุจ ุงููุนูู:
 Main script end
 Promise callback
 Timeout callback
*/


/********************************************************************
 ๐ช ุชูุงุฑูู ุนูููุฉ
 --------------------------------------------------------------------
 1๏ธโฃ ุงูุชุจ async function ุชุฌูุจ ุจูุงูุงุช ูุณุชุฎุฏู ูู API (ุจุงุณุชุฎุฏุงู fetch).
 2๏ธโฃ ุฌุฑูุจ Promise.all ู Promise.race ูุน ุฏูุงู ููููุฉ ุจุชุงุฎุฏ ููุช ูุฎุชูู.
 3๏ธโฃ ุงุนูู ุฏุงูุฉ ุจุชุณุชุฎุฏู try/catch ุฌูู async ูุชุชุนุงูู ูุน ุฃุฎุทุงุก ุงูุดุจูุฉ.
 4๏ธโฃ ุฌุฑูุจ ุจููุณู ููุงุฑูุฉ ุงูุชูููุฐ ุจูู setTimeout ู Promise.resolve().
********************************************************************/


/********************************************************************
 ๐งฉ Quick Summary
 --------------------------------------------------------------------
 โ JS ุจุชููุฐ ููุฏ ูุงุญุฏ ูู ูู ูุญุธุฉ (single-threaded)
 โ Async operations ุจุชุฑูุญ ููู Web APIs
 โ Event Loop ุจูุณูุญ ุจุชุนุฏุฏ ุงูููุงู ุงูุธุงูุฑู
 โ Promise โ ุชูุซู ุนูููุฉ ูุณุชูุจููุฉ (resolve/reject)
 โ async/await โ Syntax ุฃูุธู ููุชุงุจุฉ ุงูููุฏ ุบูุฑ ุงููุชุฒุงูู
 โ Promise.all โ ุชูุชุธุฑ ุงููู
 โ Promise.race โ ุฃูู ูุงุญุฏ ูุฎูุต
 โ Microtasks (Promises) ุชุณุจู Macrotasks (setTimeout)
********************************************************************/
